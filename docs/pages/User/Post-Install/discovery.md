---
title: Add a new cluster to Liqo
weight: 3
---


Once Liqo is installed in your cluster, you can start establishing new *peerings*.
Specifically, you can rely on three different methods to peer with other clusters:

1. **LAN Discovery**: automatic discovery of neighboring clusters available in the same LAN. This looks similar to the automatic discovery of Wi-Fi hotspots and it is particularly suitable when your cluster is composed of a single node (e.g., in combination of [K3s](https://k3s.io)).
2. **DNS Discovery**: automatic discovery of the clusters associated with a specific DNS domain (e.g.; *liqo.io*), by scraping the existence of specific DNS entries. This looks similar to the discovery of voice-over-IP SIP servers and it is mostly oriented to big organizations that wish to adopt Liqo in production.
3. **Manual Configuration**: manual addition of specific clusters to the list of known ones. This method is particularly appropriate outside LAN, without requiring any DNS configuration.

## DNS Discovery

The DNS discovery procedure requires two orthogonal actions to be enabled.
1. Register your own cluster into your DNS server to make it discoverable by others(the required parameters are presented in the section below).
2. Connect to a foreign cluster, specifying the remote domain.

### Register the home cluster

To allow the other clusters to peer with your cluster(s), you need to register a set of DNS records that specify the cluster(s) available in your domain, with the different parameters required to establish the connection.

First, you have to retrieve the Cluster ID (i.e. a unique identifier generated by Liqo for identification purposes during the peering process) of your cluster:
```
kubectl get configmap -n liqo cluster-id -o jsonpath='{.data.cluster-id}'
```

Now, it is possible to configure the records necessary to enable the DNS discovery process.
In the following, we present a `bind9`-like configuration for an hypothetical domain `example.com`. It exposes one Liqo-enabled cluster named `liqo-cluster`, with the API server accessible at `1.2.3.4:6443`.
Remember to adapt the configuration according to your setup.
```txt
example.com.                           PTR     liqo-cluster._liqo._tcp.example.com.

liqo-cluster._liqo._tcp.example.com.   SRV     0 0 6443 liqo-cluster-api.server.example.com.

liqo-cluster._liqo._tcp.example.com.   TXT     "id=${YOUR_CLUSTER_ID}"
                                               "namespace=liqo"

liqo-cluster-api-server.example.com.   A       1.2.3.4
```

{{%expand "Expand here to know more about the meaning of each record." %}}

* the `PTR` record lists the Liqo clusters exposed for the specific domain (e.g. `liqo-cluster`, reachable in `TCP`).
* the `SRV` record specifies the network parameters needed to connect to the Kubernetes API server of the cluster.
  Specifically, it has the following format:
  ```txt
   <cluster-name>._liqo._tcp.<domain>. SRV <priority> <weight> <api-server-port> <api-server-name>.
  ```
  where the priority and weight fields are unused and should be set to zero. In this case, the API server is reachable at the address `liqo-cluster-api.server.example.com` through port `6443`.
* The `A` record assigns an IP address to the DNS name of the Kubernetes API server, in this case `1.2.3.4`.
* the `TXT` record is opaque to the DNS system and it is used to store the `Cluster ID` and the `Liqo Namespace` (i.e. where the Liqo components are installed) parameters associated with the cluster.

{{% /expand %}}

### Connect to a remote cluster

In order to leverage the DNS discovery to peer to a remote cluster, it is necessary to specify the remote domain.
This operation can be easily performed through the graphical dashboard: click on the "+" icon located near Available Peers and then select "Add domain".
Here, you need to configure the following parameters:
1. **Domain**: the domain where the cluster you want to peer with is located.
2. **Name**: a mnemonic name to identify the domain.
3. **Join**: to specify whether to automatically trigger the peering procedure.

{{%expand "Using kubectl, it is also possible to perform the same configuration." %}}

```
cat << "EOF" | kubectl apply -f
apiVersion: discovery.liqo.io/v1alpha1
kind: SearchDomain
metadata:
  name: remote.com
spec:
  domain: remote.com
  autojoin: true
EOF
```

{{% /expand %}}

## Manual Configuration
### Forging the ForeignCluster

In Liqo, remote clusters are defined as `ForeignClusters`
To add a new Foreign Cluster, the Auth Service URL is the only required value to make this cluster peerable from the external world.

An example of this resource can be:

```yaml
apiVersion: discovery.liqo.io/v1alpha1
kind: ForeignCluster
metadata:
  name: my-gke-cluster
spec:
  authUrl: "https://34.71.59.19"
```

When the C.R. will be created the Liqo control plane will contact the URL shown in the step before with the curl command to
retrieve all the required cluster information.

#### Access the cluster configurations

You can get the cluster configurations from the Auth Service endpoint of the other cluster. This allows to retrieve the information necessary to peer with the remote cluster.

```bash
curl --insecure https://34.71.59.19/ids
```

```json
{"clusterId":"0558de48-097b-4b7d-ba04-6bd2a0f9d24f","clusterName":"LiqoCluster0692","guestNamespace":"liqo"}